<?xml version="1.0" encoding="utf-8" standalone="no"?>
<TfrxReport Version="4.14.7" DotMatrixReport="False" IniFile="\Software\Fast Reports" PreviewOptions.Buttons="4095" PreviewOptions.Zoom="1" PrintOptions.Printer="Default" PrintOptions.PrintOnSheet="0" ReportOptions.CreateDate="42099,7635284607" ReportOptions.Description.Text="" ReportOptions.LastChange="42100,7136254398" ScriptLanguage="PascalScript" ScriptText.Text="&#13;&#10;begin&#13;&#10;&#13;&#10;end." PropData="044C65667403980003546F700308020844617461736574730101062C20446174615365743D2241444F5175657279312220446174615365744E616D653D2241444F517565727931220000095661726961626C65730101060F204E616D653D22204172436F6D70220001063C204E616D653D2254555F4944222056616C75653D222744383646343632432D323733302D343241342D394634332D38443239383341424632314427220000055374796C650100">
  <TfrxDataPage Name="Data" Height="1000" Left="0" Top="0" Width="1000">
    <TfrxADOQuery Name="ADOQuery1" UserName="ADOQuery1" CloseDataSource="True" FieldAliases.Text="" BCDToCurrency="False" IgnoreDupParams="False" SQL.Text="SET NOCOUNT ON&#13;&#10;&#13;&#10;DECLARE @TU_ID varchar(36)&#13;&#10;&#13;&#10;SET @TU_ID = :TU_ID            &#13;&#10;&#13;&#10;DECLARE @result TABLE(&#13;&#10;  SCHEIBE integer,&#13;&#10;  PLATZ varchar(5),&#13;&#10;  KATEGORIE varchar(50)&#13;&#10;)&#13;&#10;&#13;&#10;DECLARE @Scheibenanzahl integer&#13;&#10;DECLARE @PersonenProScheibe integer&#13;&#10;&#13;&#10;SELECT&#13;&#10;  @Scheibenanzahl = TU_SCHEIBENANZAHL,&#13;&#10;  @PersonenProScheibe = TU_PERSONEN_PRO_SCHEIBE&#13;&#10;FROM TURNIER WHERE TU_ID = @TU_ID&#13;&#10;&#13;&#10;&#13;&#10;DECLARE @scheibe integer&#13;&#10;DECLARE @platz varchar(5)&#13;&#10;DECLARE @platzNummer integer&#13;&#10;&#13;&#10;SET @scheibe = 1&#13;&#10;SET @platzNummer = 0&#13;&#10;&#13;&#10;WHILE @scheibe &#60;= @Scheibenanzahl&#13;&#10;BEGIN&#13;&#10;  WHILE @platzNummer &#60; @PersonenProScheibe&#13;&#10;  BEGIN&#13;&#10;    SET @platz = CHAR(ASCII('A')+@platzNummer)&#13;&#10;    INSERT INTO @result(&#13;&#10;      SCHEIBE,&#13;&#10;	  PLATZ&#13;&#10;    )&#13;&#10;    VALUES(&#13;&#10;      @scheibe,&#13;&#10;	  @platz&#13;&#10;    )&#13;&#10;	SET @platzNummer = @platzNummer+1&#13;&#10;  END&#13;&#10;  SET @platzNummer = 0&#13;&#10;  SET @scheibe = @scheibe+1&#13;&#10;END&#13;&#10;&#13;&#10;&#13;&#10;DECLARE @tmp Table(&#13;&#10;  ANZAHL integer,&#13;&#10;  BOGENKATEGORIE varchar(50),&#13;&#10;  ALTERSKLASSE varchar(50),&#13;&#10;  SORTIERUNG integer&#13;&#10;)&#13;&#10;&#13;&#10;INSERT INTO @tmp(&#13;&#10;  ANZAHL,&#13;&#10;  BOGENKATEGORIE,&#13;&#10;  ALTERSKLASSE&#13;&#10;)&#13;&#10;SELECT&#13;&#10;    COUNT(pe.PE_BOGENKATEGORIE) AS ANZAHL,&#13;&#10;    pe.PE_BOGENKATEGORIE,&#13;&#10;    pe.PE_ALTERSKLASSE&#13;&#10;  FROM TURNIER tu&#13;&#10;    INNER JOIN TURNIER_ZUTEILUNG tz&#13;&#10;      ON tu.TU_ID = tz.TU_ID&#13;&#10;    INNER JOIN PERSON pe&#13;&#10;      ON tz.PE_ID = pe.PE_ID&#13;&#10;  WHERE tu.TU_ID = @TU_ID&#13;&#10;  GROUP BY&#13;&#10;    pe.PE_BOGENKATEGORIE,&#13;&#10;	pe.PE_ALTERSKLASSE&#13;&#10;  ORDER BY &#13;&#10;    pe.PE_BOGENKATEGORIE,&#13;&#10;	pe.PE_ALTERSKLASSE&#13;&#10;&#13;&#10;&#13;&#10;UPDATE tmp&#13;&#10;SET SORTIERUNG = di.DI_SORTIERUNG&#13;&#10;FROM TURNIER tu&#13;&#10;  INNER JOIN DISTANZ di&#13;&#10;    ON tu.TA_ID = di.TA_ID&#13;&#10;  INNER JOIN BOGENKATEGORIE bk&#13;&#10;    ON di.BK_ID = bk.BK_ID&#13;&#10;  INNER JOIN ALTERSKATEGORIE ak&#13;&#10;    ON di.AK_ID = ak.AK_ID&#13;&#10;  INNER JOIN @tmp tmp&#13;&#10;    ON bk.BK_NAME = tmp.BOGENKATEGORIE&#13;&#10;	  AND ak.AK_NAME = tmp.ALTERSKLASSE&#13;&#10;&#13;&#10;  WHERE tu.TU_ID = @TU_ID&#13;&#10;&#13;&#10;&#13;&#10;DECLARE KATEGORIE_CURSOR CURSOR FOR&#13;&#10;  SELECT&#13;&#10;    ANZAHL,&#13;&#10;	BOGENKATEGORIE + ' ' + ALTERSKLASSE AS BEZEICHNUNG,&#13;&#10;	SORTIERUNG&#13;&#10;  FROM @tmp&#13;&#10;    ORDER BY&#13;&#10;  SORTIERUNG,&#13;&#10;  BOGENKATEGORIE,&#13;&#10;  ALTERSKLASSE&#13;&#10;    &#13;&#10;&#13;&#10;DECLARE @ANZAHL integer&#13;&#10;DECLARE @BEZEICHNUNG varchar(50)&#13;&#10;DECLARE @SORTIERUNG integer&#13;&#10;&#13;&#10;OPEN KATEGORIE_CURSOR&#13;&#10;&#13;&#10;FETCH NEXT FROM KATEGORIE_CURSOR INTO&#13;&#10;  @ANZAHL,&#13;&#10;  @BEZEICHNUNG,&#13;&#10;  @SORTIERUNG&#13;&#10;&#13;&#10;WHILE @@FETCH_STATUS = 0&#13;&#10;BEGIN&#13;&#10;  --Update der einzelnen Kategorien&#13;&#10;  WITH res AS ( &#13;&#10;    SELECT TOP (@ANZAHL)&#13;&#10;    *&#13;&#10;    FROM @result&#13;&#10;    WHERE KATEGORIE IS NULL&#13;&#10;    ORDER BY&#13;&#10;      SCHEIBE,&#13;&#10;	  PLATZ,&#13;&#10;	  KATEGORIE&#13;&#10;  ) &#13;&#10;  UPDATE res&#13;&#10;  SET KATEGORIE = @BEZEICHNUNG&#13;&#10;&#13;&#10;  --AuffÃ¼llen mit leerscheiben&#13;&#10;  DECLARE @frei integer&#13;&#10;  SET @frei = @PersonenProScheibe - (@ANZAHL % @PersonenProScheibe)&#13;&#10;  IF @frei &#60; @PersonenProScheibe&#13;&#10;  BEGIN&#13;&#10;  WITH res AS ( &#13;&#10;    SELECT TOP (@frei)&#13;&#10;    *&#13;&#10;    FROM @result&#13;&#10;    WHERE KATEGORIE IS NULL&#13;&#10;    ORDER BY&#13;&#10;      SCHEIBE,&#13;&#10;	  PLATZ,&#13;&#10;	  KATEGORIE&#13;&#10;  ) &#13;&#10;  UPDATE res&#13;&#10;  SET KATEGORIE = 'frei'&#13;&#10;  END&#13;&#10;&#13;&#10;  FETCH NEXT FROM KATEGORIE_CURSOR INTO&#13;&#10;    @ANZAHL,&#13;&#10;    @BEZEICHNUNG,&#13;&#10;	@SORTIERUNG&#13;&#10;END&#13;&#10;&#13;&#10;CLOSE KATEGORIE_CURSOR&#13;&#10;DEALLOCATE KATEGORIE_CURSOR&#13;&#10;  &#13;&#10;&#13;&#10;&#13;&#10;&#13;&#10;&#13;&#10;&#13;&#10;&#13;&#10;&#13;&#10;SELECT&#13;&#10; * &#13;&#10;FROM @result&#13;&#10;ORDER BY&#13;&#10;  SCHEIBE,&#13;&#10;  PLATZ,&#13;&#10;  KATEGORIE    " CommandTimeout="30" LockType="ltReadOnly" PropData="05704C6566740398000470546F7002640A506172616D657465727301010655204E616D653D2254555F4944222044617461547970653D226674537472696E67222045787072657373696F6E3D222744383646343632432D323733302D343241342D394634332D38443239383341424632314427220000"/>
  </TfrxDataPage>
  <TfrxReportPage Name="Page1" PaperWidth="210" PaperHeight="297" PaperSize="9" LeftMargin="10" RightMargin="10" TopMargin="10" BottomMargin="10" Columns="2" ColumnWidth="95" ColumnPositions.Text="0&#13;&#10;95" HGuides.Text="" VGuides.Text="">
    <TfrxMasterData Name="MasterData1" Height="22,67718" Left="0" Top="60" Width="359,05535" ColumnWidth="0" ColumnGap="0" DataSet="ADOQuery1" DataSetName="ADOQuery1" KeepChild="True" KeepFooter="True" KeepHeader="True" KeepTogether="True" RowCount="0">
      <TfrxMemoView Name="Memo7" Left="145,27582" Top="0" Width="94,48825" Height="18,89765" ShowHint="False" Font.Charset="1" Font.Color="-16777208" Font.Height="-13" Font.Name="Arial" Font.Style="0" ParentFont="False" Text="[ADOQuery1.&#34;KATEGORIE&#34;]"/>
      <TfrxMemoView Name="Memo5" Left="40,81911" Top="0" Width="94,48825" Height="18,89765" ShowHint="False" Font.Charset="1" Font.Color="-16777208" Font.Height="-13" Font.Name="Arial" Font.Style="0" ParentFont="False" Text="[ADOQuery1.&#34;PLATZ&#34;]: "/>
    </TfrxMasterData>
    <TfrxGroupHeader Name="GroupHeader1" Height="22,67718" Left="0" Top="16" Width="359,05535" Condition="ADOQuery1.&#34;SCHEIBE&#34;" KeepTogether="True">
      <TfrxMemoView Name="Memo2" Left="58,3859" Top="0" Width="94,48825" Height="18,89765" ShowHint="False" Font.Charset="1" Font.Color="-16777208" Font.Height="-13" Font.Name="Arial" Font.Style="0" ParentFont="False" Text="[ADOQuery1.&#34;SCHEIBE&#34;]"/>
      <TfrxMemoView Name="Memo3" Left="4,33859" Top="0" Width="52,91342" Height="18,89765" ShowHint="False" Font.Charset="1" Font.Color="-16777208" Font.Height="-13" Font.Name="Arial" Font.Style="0" ParentFont="False" Text="Scheibe"/>
    </TfrxGroupHeader>
  </TfrxReportPage>
</TfrxReport>
